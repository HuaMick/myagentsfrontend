user_stories:
  # ============================================================================
  # NAVIGATION User Stories
  # ============================================================================

  - id: US-NAV-001
    name: "Deep Link Navigation to Terminal"
    category: "navigation"
    persona: "User accessing terminal via direct URL"
    priority: "high"

    starting_state:
      environment:
        app_installed: true
        platform: "web"
      knowledge:
        - "User has bookmarked /terminal URL"
        - "User expects direct access"

    journey:
      - step: 1
        action: "Navigate directly to /terminal URL"
        expected: "Terminal screen loads directly"
        failure_indicators:
          - "Redirected to pairing first"
          - "404 error"
          - "App crashes"

      - step: 2
        action: "Verify terminal screen functionality"
        expected: "Screen is fully functional"
        failure_indicators:
          - "Missing elements"
          - "Broken state"
          - "Navigation buttons don't work"

    success_criteria:
      - "Direct URL access works"
      - "No unnecessary redirects"
      - "Screen fully functional after direct access"

    testing:
      web: true
      widget_test: false
      integration_test: true

    documentation_references:
      - "lib/routing/router.dart"

  - id: US-NAV-002
    name: "Handle Invalid Routes"
    category: "navigation"
    persona: "User who enters invalid URL"
    priority: "medium"

    starting_state:
      environment:
        app_installed: true
        platform: "web"
      knowledge:
        - "User may mistype URL"
        - "User expects helpful error"

    journey:
      - step: 1
        action: "Navigate to invalid URL like /invalid-page"
        expected: "Error page is displayed"
        failure_indicators:
          - "App crashes"
          - "Blank screen"
          - "Unhandled exception"

      - step: 2
        action: "Observe error message"
        expected: "Clear 'Page not found' message with the invalid path shown"
        failure_indicators:
          - "No error message"
          - "Technical jargon"
          - "Missing path information"

      - step: 3
        action: "Verify app is still usable"
        expected: "Can navigate away from error page"
        failure_indicators:
          - "Stuck on error page"
          - "Back button broken"
          - "App unresponsive"

    success_criteria:
      - "Invalid routes show error page"
      - "Error message is user-friendly"
      - "App remains functional"
      - "Navigation still works"

    testing:
      web: true
      widget_test: true
      integration_test: true

    documentation_references:
      - "lib/routing/router.dart"

  - id: US-NAV-003
    name: "Browser History Navigation"
    category: "navigation"
    persona: "User using browser back/forward buttons"
    priority: "high"

    starting_state:
      environment:
        app_installed: true
        platform: "web"
        current_screen: "pairing"
      knowledge:
        - "User expects browser history to work"
        - "User uses back/forward buttons"

    journey:
      - step: 1
        action: "Navigate from pairing to terminal using in-app button"
        expected: "Terminal screen loads, URL is /terminal"
        failure_indicators:
          - "URL doesn't update"
          - "Navigation fails"

      - step: 2
        action: "Click browser back button"
        expected: "Returns to pairing screen, URL is /"
        failure_indicators:
          - "Nothing happens"
          - "Page reloads fully"
          - "App crashes"
          - "Wrong page shown"

      - step: 3
        action: "Click browser forward button"
        expected: "Returns to terminal screen, URL is /terminal"
        failure_indicators:
          - "Nothing happens"
          - "Page reloads fully"
          - "App state lost"

    success_criteria:
      - "Browser history entries created"
      - "Back button navigates correctly"
      - "Forward button navigates correctly"
      - "App state preserved where appropriate"

    testing:
      web: true
      widget_test: false
      integration_test: true

    documentation_references:
      - "lib/routing/router.dart"

  - id: US-NAV-004
    name: "Page Refresh Recovery"
    category: "navigation"
    persona: "User who refreshes the page"
    priority: "medium"

    starting_state:
      environment:
        app_installed: true
        platform: "web"
        current_screen: "terminal"
      knowledge:
        - "User may accidentally refresh"
        - "User expects same page to reload"

    journey:
      - step: 1
        action: "On terminal screen, refresh the page (F5 or browser refresh)"
        expected: "Terminal screen reloads at /terminal"
        failure_indicators:
          - "Redirected to pairing"
          - "Error page shown"
          - "App fails to load"

      - step: 2
        action: "Verify screen functionality after refresh"
        expected: "Screen is fully functional"
        failure_indicators:
          - "Broken UI"
          - "Missing elements"
          - "Console errors"

    success_criteria:
      - "Current route preserved on refresh"
      - "App reloads correctly"
      - "No state corruption"

    testing:
      web: true
      widget_test: false
      integration_test: false

    documentation_references:
      - "lib/routing/router.dart"
