user_stories:
  # ============================================================================
  # FUTURE FEATURES User Stories (for when features are implemented)
  # ============================================================================
  # NOTE: These user stories are placeholders for features planned based on
  # the pubspec.yaml dependencies. Enable them when features are implemented.

  - id: US-WS-001
    name: "WebSocket Connection to Relay Server"
    category: "websocket"
    persona: "User connecting to remote session via relay server"
    priority: "critical"

    dependencies_required:
      - "web_socket_channel: ^2.4.0"

    starting_state:
      environment:
        app_installed: true
        platform: "web"
        paired: true
        relay_server_available: true
      knowledge:
        - "User has valid pairing code"
        - "Relay server is running and accessible at relay.remoteagents.dev"

    journey:
      - step: 1
        action: "Enter pairing code and click Connect"
        expected: "WebSocket connection initiated to wss://relay.remoteagents.dev/ws/client/{pairingCode}"
        failure_indicators:
          - "Connection fails immediately"
          - "Timeout without feedback"
          - "No error message on failure"

      - step: 2
        action: "Wait for connection establishment"
        expected: "Connection status indicates success, RelayClient reports connected state"
        failure_indicators:
          - "Stuck in connecting state"
          - "Silent failure"
          - "No connection indicator"

      - step: 3
        action: "Observe connected state"
        expected: "Connection established, auto-reconnect enabled, ready for encrypted message exchange"
        failure_indicators:
          - "Connection drops immediately"
          - "No auto-reconnect on disconnect"
          - "WebSocket channel not initialized"

    success_criteria:
      - "WebSocket connection establishes to relay server"
      - "Connection state is managed correctly"
      - "Auto-reconnection works on disconnect with exponential backoff"
      - "Message stream is available for communication"

    testing:
      web: true
      widget_test: false
      integration_test: true
      note: "Requires mock WebSocket server for testing"

    documentation_references:
      - "lib/core/networking/relay_client.dart"
      - "lib/core/networking/connection_state.dart"

  - id: US-CRYPT-001
    name: "Encrypted Communication with NaCl"
    category: "security"
    persona: "User expecting secure end-to-end encrypted communication"
    priority: "critical"

    dependencies_required:
      - "pinenacl: ^0.5.1"

    starting_state:
      environment:
        app_installed: true
        platform: "web"
        connected: true
        key_pair_generated: true
      knowledge:
        - "User expects E2E encryption"
        - "User has established connection"
        - "Key pairs have been generated (X25519)"

    journey:
      - step: 1
        action: "Send a message through the relay"
        expected: "Message is encrypted using NaCl Box (X25519-XSalsa20-Poly1305) before transmission"
        failure_indicators:
          - "Plaintext visible in network tab"
          - "Encryption errors"
          - "Message fails to send"
          - "No nonce in encrypted message"

      - step: 2
        action: "Inspect encrypted message format"
        expected: "Message format is Base64(nonce || ciphertext) with 24-byte nonce and Poly1305 MAC"
        failure_indicators:
          - "Wrong encryption format"
          - "Missing nonce or MAC"
          - "Not Base64 encoded"

      - step: 3
        action: "Receive encrypted response from remote peer"
        expected: "Response is decrypted correctly and displayed as plaintext"
        failure_indicators:
          - "Garbled text displayed"
          - "Decryption errors"
          - "MAC verification fails"
          - "Response lost"

    success_criteria:
      - "All communication encrypted with NaCl Box"
      - "X25519 key pairs generated correctly"
      - "Encryption format matches PyNaCl compatibility"
      - "No plaintext in transit (verify in network tab)"
      - "MAC verification prevents message tampering"

    testing:
      web: true
      widget_test: true
      integration_test: true
      note: "Verify encryption via network inspection and unit tests"

    documentation_references:
      - "lib/core/crypto/nacl_crypto.dart"
      - "lib/core/crypto/key_pair.dart"
      - "lib/core/crypto/message_envelope.dart"

  - id: US-XTERM-001
    name: "Terminal Input and Output"
    category: "terminal"
    persona: "User typing commands in terminal"
    priority: "critical"
    status: "future"

    dependencies_required:
      - "xterm: ^4.0.0"

    starting_state:
      environment:
        app_installed: true
        platform: "web"
        connected: true
        terminal_active: true
      knowledge:
        - "User is connected to remote session"
        - "Terminal is ready for input"

    implementation_note: "Terminal screen currently exists as placeholder only. Xterm.js integration is pending."

    journey:
      - step: 1
        action: "Type text into terminal"
        expected: "Characters appear in terminal as typed"
        failure_indicators:
          - "Input not visible"
          - "Characters doubled"
          - "Wrong characters"
          - "Input lag"

      - step: 2
        action: "Press Enter to submit command"
        expected: "Command sent to remote, response appears"
        failure_indicators:
          - "Enter does nothing"
          - "No response received"
          - "Response corrupted"

      - step: 3
        action: "View terminal output"
        expected: "Output formatted correctly with colors/styles"
        failure_indicators:
          - "ANSI codes visible as text"
          - "Colors not rendering"
          - "Layout broken"

    success_criteria:
      - "Terminal accepts keyboard input"
      - "Output displays correctly"
      - "ANSI escape codes rendered"
      - "Scrolling works"

    testing:
      web: true
      widget_test: false
      integration_test: true

    documentation_references:
      - "lib/features/remote_terminal/terminal_screen.dart"

  - id: US-VOICE-001
    name: "Voice Input to Terminal"
    category: "voice"
    persona: "User who wants to use voice commands"
    priority: "medium"
    status: "future"

    dependencies_required:
      - "deepgram_speech_to_text: ^2.0.0"

    starting_state:
      environment:
        app_installed: true
        platform: "web"
        connected: true
        microphone_available: true
      knowledge:
        - "User has microphone access"
        - "User wants to speak instead of type"

    implementation_note: "Voice feature directory exists but is empty. Voice input integration not yet implemented."

    journey:
      - step: 1
        action: "Activate voice input mode"
        expected: "Voice recording indicator appears"
        failure_indicators:
          - "No voice button"
          - "Permission denied without prompt"
          - "Silent failure"

      - step: 2
        action: "Speak command clearly"
        expected: "Speech transcribed to text in real-time"
        failure_indicators:
          - "No transcription"
          - "Severely inaccurate transcription"
          - "Long delay"

      - step: 3
        action: "Review and submit transcription"
        expected: "Transcribed text sent as terminal command"
        failure_indicators:
          - "Cannot edit before send"
          - "Wrong text sent"

    success_criteria:
      - "Microphone access requested properly"
      - "Speech transcription works"
      - "Transcription editable before send"
      - "Clear audio feedback"

    testing:
      web: true
      widget_test: false
      integration_test: true
      note: "Requires microphone access, may need manual testing"

    documentation_references:
      - "lib/features/voice/ (when created)"
